<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Linear Equation (HHL) - Quanta.Guru</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Linear Equation (HHL)";
    var mkdocs_page_input_path = "algorithms/hhl/hhl.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Quanta.Guru</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="tocbase current">
    
    
      


  <li class="navtree toctree-l1 inactive">
    <a class="" href="../../..">Home</a>
  </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Getting started</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../GettingStarted/anaconda/">Guide to starting Python</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../GettingStarted/lib/">Guide to Python Libraries</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../GettingStarted/env/">Setting up Python Environment</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../GettingStarted/jupyter/">Installing Jupyter Notebook</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../GettingStarted/git/">How to Git</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Quantum Gates</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../gates/sgates/sgates/">Single Qubit Gates</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../gates/mgates/mgates/">Multiple Qubits Gates</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Quantum Circuits</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../circuits/hadamard/hadamard/">Superposition</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../circuits/bell/bell/">Bell state</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../circuits/random/random/">Random Variables</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Algorithms</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../qft/qft/">Quantum Fourier Transform</a>
  </li>
        
          


  
    
    <li class="navtree toctree-l2 page current">
      <a class="current" href="./">
        Linear Equation (HHL)
          <span class="toctree-expand"></span>
      </a>
    </li>
    
      

  <li class="toctree-l2 current with-children">
    <a href="#qiskit-aqua-solving-linear-systems-of-equations-with-the-hhl-algorithm">
      Qiskit Aqua: Solving linear systems of equations with the HHL algorithm
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l2 current">
    <ul class="subnav-l2 current">
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#contributors">Contributors</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#affiliation">Affiliation</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#2x2-diagonal-matrix">2x2 diagonal matrix</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#2x2-non-diagonal-matrix">2x2 non-diagonal matrix</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#8x8-non-diagonal-matrix">8x8 non-diagonal matrix</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#4x4-randomly-generated-matrix">4x4 randomly-generated matrix</a>
        </li>
    
    </ul>
  </li>


  
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../shor/shor/">Shor's Algorithm</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../grover/grover/">Grover's Algorithm</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Optimization</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../optimization/dwave/dwave/">Binary Quadratic Model (BQM)</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../optimization/routing/routing/">Vahicle Routing</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../optimization/salesman/salesman/">Travelling Salsesman</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Quantum Machine Learning</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../qml/qsvm/qsvm/">Quantum SVM</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">References</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../References/ref/">Reference</a>
  </li>
        
      </ul>
    </li>
    
  </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Quanta.Guru</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Algorithms &raquo;</li>
        
      
    
    <li>Linear Equation (HHL)</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="qiskit-aqua-solving-linear-systems-of-equations-with-the-hhl-algorithm"><em><em>Qiskit Aqua: Solving linear systems of equations with the HHL algorithm</em></em></h1>
<hr />
<h3 id="contributors">Contributors</h3>
<p>David Bucher<sup>[1]</sup>, Jan Mueggenburg<sup>[1]</sup>, Gawel Kus<sup>[1]</sup>, Isabel Haide<sup>[1]</sup>, Shubha Deutschle<sup>[1]</sup>, Harry Barowski<sup>[1]</sup>, Dominik Steenken<sup>[1]</sup>, and Albert Frisch<sup>[1]</sup></p>
<h3 id="affiliation">Affiliation</h3>
<ul>
<li><sup>[1]</sup>IBMQ</li>
</ul>
<p>The HHL algorithm (after the authorâ€™s surnames Harrow-Hassidim-Lloyd) [1] is a quantum algorithm to solve systems of linear equations\(A \vec{x} = \vec{b}\)To perform this calculation quantum mechanically, we need in general 4 main steps requiring three qubit registers:
<ol>
<li>First, we have to express the vector \(\vec{b}\) as a quantum state \(|b\rangle\) on a quantum register.</li>
<li>Now, we have to decompose\(\vec{b}\)into a superposition of eigenvectors of A remembering on the linear combination of the vector \(\vec{b}\) We achieve this using the Quantum Phase Estimation algorithm (Quantum Phase Estimation (QPE)). Since the matrix is hereby diagonalized wherefore\(A\)is easily invertible.</li>
<li>The inversion of the eigenvector base of \(A\) is achieved by rotating an ancillary qubit by an angle \(\arcsin \left( \frac{C}{\lambda <em>{\text{i}}} \right)\) around the y-axis where \(\lambda</em>{\text{i}}\) are the eigenvalues of \(A\) Now, we obtain the state \(A^{-1}|b\rangle = |x \rangle\) .</li>
<li>We need to uncompute the register storing the eigenvalues using the inverse QPE. We measure the ancillary qubit whereby the measurement of 1 indicates that the matrix inversion was successful. The inverse QPE leaves the system in a state proportional to the solution vector \(|x\rangle \) In many cases one is not interested in the single vector elements of \(|x\rangle\) but only on certain properties. These are accessible by applying a problem-specific operator \(M\) o the state \(|x\rangle\) Another use-case of the HHL algorithm is the implementation in a larger quantum program.</li>
</ol></p>
<p>Currently only hermitian matrices with a dimension of \(2^n\) are supported.</p>
<p>Take into account that in the general case, the entries of\(\vec{x}\)can not be efficiently read out because we would need to know all coefficients describing the quantum state.
In the following examples, we ignore this constraint and show for our small linear system as a proof of principle that\(\vec{x}\) is calculated correctly.</p>
<hr />
<p>References:</p>
<ul>
<li>A. W. Harrow, A. Hassidim, and S. Lloyd, Phys. Rev. Lett. 103, 150502 (2009), e-print arXiv 0811.3171</li>
<li>S. Barz, I. Kassal, M. Ringbauer, Y. Ole Lipp, B. DakiÄ‡, A. Aspuru-Guzik, and P. Walther, Sci Rep. 4: 6115 (2014), e-print arXiv 1302.1210</li>
</ul>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.aqua</span> <span style="color: #006699; font-weight: bold">import</span> run_algorithm
<span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.aqua.input</span> <span style="color: #006699; font-weight: bold">import</span> LinearSystemInput
<span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.quantum_info</span> <span style="color: #006699; font-weight: bold">import</span> state_fidelity
<span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.aqua.algorithms.classical</span> <span style="color: #006699; font-weight: bold">import</span> ExactLSsolver
<span style="color: #006699; font-weight: bold">import</span> <span style="color: #00CCFF; font-weight: bold">numpy</span> <span style="color: #006699; font-weight: bold">as</span> <span style="color: #00CCFF; font-weight: bold">np</span>
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>qiskit.providers.ibmq.ibmqprovider
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>params <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;problem&#39;</span>: {
        <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;linear_system&#39;</span>
    },
    <span style="color: #CC3300">&#39;algorithm&#39;</span>: {
        <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;HHL&#39;</span>
    },
    <span style="color: #CC3300">&#39;eigs&#39;</span>: {
        <span style="color: #CC3300">&#39;expansion_mode&#39;</span>: <span style="color: #CC3300">&#39;suzuki&#39;</span>,
        <span style="color: #CC3300">&#39;expansion_order&#39;</span>: <span style="color: #FF6600">2</span>,
        <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;EigsQPE&#39;</span>,
        <span style="color: #CC3300">&#39;num_ancillae&#39;</span>: <span style="color: #FF6600">3</span>,
        <span style="color: #CC3300">&#39;num_time_slices&#39;</span>: <span style="color: #FF6600">50</span>
    },
    <span style="color: #CC3300">&#39;reciprocal&#39;</span>: {
        <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;Lookup&#39;</span>
    },
    <span style="color: #CC3300">&#39;backend&#39;</span>: {
        <span style="color: #CC3300">&#39;provider&#39;</span>: <span style="color: #CC3300">&#39;qiskit.BasicAer&#39;</span>,
        <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;statevector_simulator&#39;</span>
    }
}

<span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">fidelity</span>(hhl, ref):
    solution_hhl_normed <span style="color: #555555">=</span> hhl <span style="color: #555555">/</span> np<span style="color: #555555">.</span>linalg<span style="color: #555555">.</span>norm(hhl)
    solution_ref_normed <span style="color: #555555">=</span> ref <span style="color: #555555">/</span> np<span style="color: #555555">.</span>linalg<span style="color: #555555">.</span>norm(ref)
    fidelity <span style="color: #555555">=</span> state_fidelity(solution_hhl_normed, solution_ref_normed)
    <span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;fidelity </span><span style="color: #AA0000">%f</span><span style="color: #CC3300">&quot;</span> <span style="color: #555555">%</span> fidelity)
</pre></div>


<h2 id="2x2-diagonal-matrix">2x2 diagonal matrix</h2>
<p>First, we show an example for running the HHL algorithm with Qiskit Aqua on a diagonal matrix as input
$$ A=
\begin{bmatrix}
1 &amp; 0 \
0 &amp; 2
\end{bmatrix}$$</p>
<p>with the vector \(\vec{b}= \left( \begin{array}{c}1 \ 4  \end{array} \right)\)
The <code>result</code> dictionary contains several return values. The HHL solution for\(\vec{x}\)is accessible by the key <code>'solution'</code>. For comparison, also the classical solution of the linear system of equations is calculated using standard linear algebra functions in numpy. The fidelity between the HHL solution and the classical solution is also given in the output. Furthermore, the probability is shown with which HHL was running successfully, i.e. the HHL ancillary qubit has been measured to be\(|1\rangle\).</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>matrix <span style="color: #555555">=</span> [[<span style="color: #FF6600">1</span>, <span style="color: #FF6600">0</span>], [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">2</span>]]
vector <span style="color: #555555">=</span> [<span style="color: #FF6600">1</span>, <span style="color: #FF6600">4</span>]
params[<span style="color: #CC3300">&#39;input&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;LinearSystemInput&#39;</span>,
    <span style="color: #CC3300">&#39;matrix&#39;</span>: matrix,
    <span style="color: #CC3300">&#39;vector&#39;</span>: vector
}
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>result <span style="color: #555555">=</span> run_algorithm(params)
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;solution &quot;</span>, np<span style="color: #555555">.</span>round(result[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

result_ref <span style="color: #555555">=</span> ExactLSsolver(matrix, vector)<span style="color: #555555">.</span>run()
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;classical solution &quot;</span>, np<span style="color: #555555">.</span>round(result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;probability </span><span style="color: #AA0000">%f</span><span style="color: #CC3300">&quot;</span> <span style="color: #555555">%</span> result[<span style="color: #CC3300">&#39;probability_result&#39;</span>])
fidelity(result[<span style="color: #CC3300">&#39;solution&#39;</span>], result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>solution  [1.05859+0.j 1.99245+0.j]
classical solution  [1. 2.]
probability 0.024630
fidelity 0.999389
</pre></div>


<p>The probabilty that HHL runs successfully depends on the constant\(C\)(see step 3. in the introduction). In the HHL algorithm,\(C\)can be given as the parameter <code>scale</code>\(\in [0,1]\)In the above example <code>scale</code> is not defined in the <code>params</code> dictionary and the HHL algorithm initializes it to the smallest possible eigenvalue before execution. Alternatively, we can set <code>scale</code> to 0.5 and see how the results are influenced thereby.</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>params2 <span style="color: #555555">=</span> params
params2[<span style="color: #CC3300">&#39;reciprocal&#39;</span>] <span style="color: #555555">=</span> {    
    <span style="color: #CC3300">&#39;scale&#39;</span>: <span style="color: #FF6600">0.5</span>
}

result <span style="color: #555555">=</span> run_algorithm(params2)
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;solution &quot;</span>, np<span style="color: #555555">.</span>round(result[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

result_ref <span style="color: #555555">=</span> ExactLSsolver(matrix, vector)<span style="color: #555555">.</span>run()
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;classical solution &quot;</span>, np<span style="color: #555555">.</span>round(result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;probability </span><span style="color: #AA0000">%f</span><span style="color: #CC3300">&quot;</span> <span style="color: #555555">%</span> result[<span style="color: #CC3300">&#39;probability_result&#39;</span>])
fidelity(result[<span style="color: #CC3300">&#39;solution&#39;</span>], result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>solution  [0.84664+0.j 2.01762+0.j]
classical solution  [1. 2.]
probability 0.361437
fidelity 0.995605
</pre></div>


<p>If you want to know how many qubits are required (circuit width) or how large the maximum number of gates applied to a single qubit (circuit depth) is, you can print it out by</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_width&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;width&#39;</span>])
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_depth&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;depth&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>circuit_width 7
circuit_depth 12256
</pre></div>


<hr />
<h2 id="2x2-non-diagonal-matrix">2x2 non-diagonal matrix</h2>
<p>Here we show an example for running the HHL algorithm with Qiskit Aqua on a non-diagonal matrix as input</p>
<p>$$ A = \begin{bmatrix}
1 &amp; 3 \\
3 &amp; 2
\end{bmatrix}$$</p>
<p>with the vector \(\vec{b}= \left( \begin{array}{c}1 \\ 1  \end{array} \right) \)</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>matrix <span style="color: #555555">=</span> [[<span style="color: #FF6600">1</span>, <span style="color: #FF6600">3</span>], [<span style="color: #FF6600">3</span>, <span style="color: #FF6600">2</span>]]
vector <span style="color: #555555">=</span> [<span style="color: #FF6600">1</span>, <span style="color: #FF6600">1</span>]
params3 <span style="color: #555555">=</span> params
params3[<span style="color: #CC3300">&#39;input&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;LinearSystemInput&#39;</span>,
    <span style="color: #CC3300">&#39;matrix&#39;</span>: matrix,
    <span style="color: #CC3300">&#39;vector&#39;</span>: vector
}
params3[<span style="color: #CC3300">&#39;reciprocal&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;negative_evals&#39;</span>: <span style="color: #336666">True</span>
}
params3[<span style="color: #CC3300">&#39;eigs&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;negative_evals&#39;</span>: <span style="color: #336666">True</span>
}
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>result <span style="color: #555555">=</span> run_algorithm(params3)
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;solution &quot;</span>, np<span style="color: #555555">.</span>round(result[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

result_ref <span style="color: #555555">=</span> ExactLSsolver(matrix, vector)<span style="color: #555555">.</span>run()
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;classical solution &quot;</span>, np<span style="color: #555555">.</span>round(result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;probability </span><span style="color: #AA0000">%f</span><span style="color: #CC3300">&quot;</span> <span style="color: #555555">%</span> result[<span style="color: #CC3300">&#39;probability_result&#39;</span>])
fidelity(result[<span style="color: #CC3300">&#39;solution&#39;</span>], result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>solution  [0.14223-5.e-05j 0.28622+7.e-05j]
classical solution  [0.14286 0.28571]
probability 0.000316
fidelity 0.999994
</pre></div>


<p>Compared to the the first example, the circuit depth is increased approximately by a factor of 6</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_width&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;width&#39;</span>])
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_depth&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;depth&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>circuit_width 11
circuit_depth 73313
</pre></div>


<hr />
<h2 id="8x8-non-diagonal-matrix">8x8 non-diagonal matrix</h2>
<p>For simplicity, we show a HHL execution of a linear systom of equations defined by the following 8x8 dimensional matrix
$$ A = \begin{bmatrix}
4 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 3 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 8 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 2 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 5
\end{bmatrix}$$
and the vector \(\vec{b}= \left( \begin{array}{c}1 \\0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 1 \end{array} \right)\)</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>matrix <span style="color: #555555">=</span> [[<span style="color: #FF6600">4</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">1</span>],
          [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">3</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>],
          [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">8</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>],
          [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">5</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>],
          [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">2</span>, <span style="color: #FF6600">1</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>],
          [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">1</span>, <span style="color: #FF6600">1</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>],
          [<span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">1</span>, <span style="color: #FF6600">0</span>],
          [<span style="color: #FF6600">1</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">5</span>]]
vector <span style="color: #555555">=</span> [<span style="color: #FF6600">1</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">0</span>, <span style="color: #FF6600">1</span>]
params4 <span style="color: #555555">=</span> params
params4[<span style="color: #CC3300">&#39;input&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;LinearSystemInput&#39;</span>,
    <span style="color: #CC3300">&#39;matrix&#39;</span>: matrix,
    <span style="color: #CC3300">&#39;vector&#39;</span>: vector
}
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>result <span style="color: #555555">=</span> run_algorithm(params4)
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;solution &quot;</span>, np<span style="color: #555555">.</span>round(result[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

result_ref <span style="color: #555555">=</span> ExactLSsolver(matrix, vector)<span style="color: #555555">.</span>run()
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;classical solution &quot;</span>, np<span style="color: #555555">.</span>round(result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;probability </span><span style="color: #AA0000">%f</span><span style="color: #CC3300">&quot;</span> <span style="color: #555555">%</span> result[<span style="color: #CC3300">&#39;probability_result&#39;</span>])
fidelity(result[<span style="color: #CC3300">&#39;solution&#39;</span>], result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>solution  [ 0.18195-0.j  0.     -0.j  0.     -0.j -0.     +0.j  0.     +0.j
 -0.     +0.j -0.     -0.j  0.18041+0.j]
classical solution  [0.21053 0.      0.      0.      0.      0.      0.      0.15789]
probability 0.935566
fidelity 0.981173
</pre></div>


<p>Considering the circuit depth and circuit width</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_width&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;width&#39;</span>])
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_depth&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;depth&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>circuit_width 9
circuit_depth 315281
</pre></div>


<hr />
<h2 id="4x4-randomly-generated-matrix">4x4 randomly-generated matrix</h2>
<p>Now, we show the application of HHL on a randomly-generated 4x4 matrix. We use the function <code>random_hermitian</code> to generate a random hermitian matrix and initialize the random seed to achieve reproducibility of the HHL run. Since the matrix can have negative eigenvalues, the <code>params</code> dictionary has to be modified by <code>"negative_evals": True</code> in <code>"eigs"</code> and <code>"reciprocal"</code>, respectively. We choose
$$\vec{b}= \left( \begin{array}{c}1 \ 2 \ 3 \ 1 \end{array} \right)$$</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit</span> <span style="color: #006699; font-weight: bold">import</span> BasicAer
<span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.aqua</span> <span style="color: #006699; font-weight: bold">import</span> QuantumInstance
<span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.aqua.algorithms.single_sample</span> <span style="color: #006699; font-weight: bold">import</span> HHL
<span style="color: #006699; font-weight: bold">from</span> <span style="color: #00CCFF; font-weight: bold">qiskit.aqua.utils</span> <span style="color: #006699; font-weight: bold">import</span> random_hermitian
</pre></div>


<p>It is needed for this example to define the "initial_state", the "qft" and the "iqft" additionally:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>params5 <span style="color: #555555">=</span> params
params5[<span style="color: #CC3300">&#39;algorithm&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;truncate_powerdim&#39;</span>: <span style="color: #336666">False</span>,
    <span style="color: #CC3300">&#39;truncate_hermitian&#39;</span>: <span style="color: #336666">False</span>
}
params5[<span style="color: #CC3300">&#39;reciprocal&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;Lookup&#39;</span>,
    <span style="color: #CC3300">&#39;negative_evals&#39;</span>: <span style="color: #336666">True</span>
}
params5[<span style="color: #CC3300">&#39;eigs&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;expansion_mode&#39;</span>: <span style="color: #CC3300">&#39;suzuki&#39;</span>,
    <span style="color: #CC3300">&#39;expansion_order&#39;</span>: <span style="color: #FF6600">2</span>,
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;EigsQPE&#39;</span>,
    <span style="color: #CC3300">&#39;negative_evals&#39;</span>: <span style="color: #336666">True</span>,
    <span style="color: #CC3300">&#39;num_ancillae&#39;</span>: <span style="color: #FF6600">6</span>,
    <span style="color: #CC3300">&#39;num_time_slices&#39;</span>: <span style="color: #FF6600">70</span>
}
params5[<span style="color: #CC3300">&#39;initial_state&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;CUSTOM&#39;</span>
}
params5[<span style="color: #CC3300">&#39;iqft&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;STANDARD&#39;</span>
}
params5[<span style="color: #CC3300">&#39;qft&#39;</span>] <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&#39;name&#39;</span>: <span style="color: #CC3300">&#39;STANDARD&#39;</span>
}
</pre></div>


<p>In this example, we create an instance of the <code>HHL</code> class and run the algorithm with an input that is created programatically. To get the same pseudo-random matrix for every run, we set the random seed by using <code>np.random.seed(1)</code>.</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># set the random seed to get the same pseudo-random matrix for every run</span>
np<span style="color: #555555">.</span>random<span style="color: #555555">.</span>seed(<span style="color: #FF6600">1</span>)
matrix <span style="color: #555555">=</span> random_hermitian(<span style="color: #FF6600">4</span>)
vector <span style="color: #555555">=</span> [<span style="color: #FF6600">1</span>, <span style="color: #FF6600">2</span>, <span style="color: #FF6600">3</span>, <span style="color: #FF6600">1</span>]

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;random matrix:&quot;</span>)
m <span style="color: #555555">=</span> np<span style="color: #555555">.</span>array(matrix)
<span style="color: #006699; font-weight: bold">print</span>(np<span style="color: #555555">.</span>round(m, <span style="color: #FF6600">3</span>))

algo_input <span style="color: #555555">=</span> LinearSystemInput(matrix<span style="color: #555555">=</span>matrix, vector<span style="color: #555555">=</span>vector)
hhl <span style="color: #555555">=</span> HHL<span style="color: #555555">.</span>init_params(params5, algo_input)
backend <span style="color: #555555">=</span> BasicAer<span style="color: #555555">.</span>get_backend(<span style="color: #CC3300">&#39;statevector_simulator&#39;</span>)
quantum_instance <span style="color: #555555">=</span> QuantumInstance(backend<span style="color: #555555">=</span>backend)
result <span style="color: #555555">=</span> hhl<span style="color: #555555">.</span>run(quantum_instance)
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;solution &quot;</span>, np<span style="color: #555555">.</span>round(result[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

result_ref <span style="color: #555555">=</span> ExactLSsolver(matrix, vector)<span style="color: #555555">.</span>run()
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;classical solution &quot;</span>, np<span style="color: #555555">.</span>round(result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>], <span style="color: #FF6600">5</span>))

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;probability </span><span style="color: #AA0000">%f</span><span style="color: #CC3300">&quot;</span> <span style="color: #555555">%</span> result[<span style="color: #CC3300">&#39;probability_result&#39;</span>])
fidelity(result[<span style="color: #CC3300">&#39;solution&#39;</span>], result_ref[<span style="color: #CC3300">&#39;solution&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>random matrix:
[[ 0.284-0.j    -0.257-0.051j -0.124+0.033j  0.038+0.023j]
 [-0.257+0.051j  0.404+0.j     0.067-0.079j  0.054+0.055j]
 [-0.124-0.033j  0.067+0.079j  0.282-0.j     0.043+0.004j]
 [ 0.038-0.023j  0.054-0.055j  0.043-0.004j  0.206-0.j   ]]
solution  [ 79.9768  +4.52073j  60.28272 +3.09211j  37.51853 -9.5858j
 -35.02324+26.46894j]
classical solution  [ 76.1399  +1.92451j  57.30622 +1.20141j  35.96381-10.07775j
 -32.03837+25.90593j]
probability 0.256771
fidelity 0.999946
</pre></div>


<p>The circuit width and depth are</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_width&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;width&#39;</span>])
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;circuit_depth&quot;</span>, result[<span style="color: #CC3300">&#39;circuit_info&#39;</span>][<span style="color: #CC3300">&#39;depth&#39;</span>])
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>circuit_width 12
circuit_depth 973537
</pre></div>


<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../shor/shor/" class="btn btn-neutral float-right" title="Shor's Algorithm">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../qft/qft/" class="btn btn-neutral" title="Quantum Fourier Transform"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../qft/qft/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../shor/shor/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
